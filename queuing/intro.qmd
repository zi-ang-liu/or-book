---
title: 待ち行列モデルの基礎
format:
  html:
    code-fold: true
jupyter: python3
---

@fig-typical-queueing-system は，典型的な待ち行列システムを示している．**客**（customer）はシステムに**到着**（arrival）し，**待ち行列**（queue）に並び，サービスを受け，最後にシステムを**退出**（departure）する．

![A typical queueing system](images/typical_queueing.svg){#fig-typical-queueing-system}

## ケンドールの記号

待ち行列モデルは，**ケンドールの記号**（Kendall's notation）により表現する．

$$
A/B/X
$$

ここで，$A$ は到着時間間隔分布の種類，$B$ はサービス時間分布の種類，$X$ はサーバ数を表す．$A$ と $B$ には以下の記号が用いられる．

|記号|意味|
|----|----|
| $M$ | 指数分布|
| $D$ | 決定論的|
| $G$ | 一般分布|
| $E_k$ | $k$ 次アーラン分布|
| $H_k$ | $k$ 次超指数分布|

例えば，客の到着時間間隔が指数分布に従い，サービス時間が一定であり，サーバ数が1である場合，その待ち行列モデルは $M/D/1$ と表される．

:::{.callout-note}
### なぜ指数分布は $M$ と書くのか
1. アーラン分布 $E_k$ と間違えないようにするため．
2. 指数分布のマルコフ性（Markovian property）と無記憶性（memoryless property）に由来する．
:::

## 評価指標

待ち行列理論の代表的な性能評価指標を紹介する．一般に，待ち行列システムは待ち行列とサーバから構成され，それぞれが評価対象となる．

**滞在時間**は客がシステムに到着してサービスを受け，システムを退出するまでにかかる時間である．**平均待ち時間**は，客がシステムに到着してからサービスを受けるまでの時間である．平均滞在時間は $W$，平均待ち時間は $W_q$ で表す．

**系内客数**は待ち行列システム内にいる客数である．**待ち行列長**は待ち行列にいる客数である．平均系内客数は $L$，平均待ち行列長は $L_q$ で表す．

|  | システム | 待ち行列 |
| -------- | -------- | -------- |
|客数 | 系内客数 | 待ち行列長 |
|時間 | 滞在時間 | 待ち時間 |

<!-- $1/\lambda$ は平均到着間隔，$1/\mu$ は平均サービス時間を表す．利用率 $\rho$ は，次の式で定義される．

$$
\rho = \frac{\lambda}{s \mu}
$$

:::{#exm-ice-cream}
あるアイスクリーム屋さんでは，1名の店員が客の注文を受け付け，アイスクリームを提供している．平均して，1時間に30人の客が来店している．店員は，1時間に60人の客に対応できる．このとき，平均到着率 $\lambda$ は30人/時間，平均サービス率 $\mu$ は60人/時間である．サーバ数 $s = 1$ であるため，利用率は

$$
\rho = \frac{30}{1 \times 60} = 0.5
$$
となる．また，1時間あたりの到着率が30人であるため，平均到着間隔は $1/\lambda = 1/30$ 時間，平均サービス時間は $1/\mu = 1/60$ 時間である．これを分単位で表すと，平均到着間隔は2分，平均サービス時間は1分となる．
:::

| 記号 | 意味 |
| ---- | ---- |
| $L$ | 平均系内客数 |
| $W$ | 平均滞在時間|
| $L_q$ | 平均待ち行列長 |
| $W_q$ | 平均待ち時間 |
| $\lambda$ | 平均到着率，単位時間あたりの到着客数の平均|
| $\mu$ | 平均サービス率，単位時間あたりに処理できる客数の平均|
| $\rho$ | 利用率|
| $s$ | サーバ数 | -->

## リトルの法則

**リトルの法則**（Little's Law）は，待ち行列理論における基本的な関係式であり，平均系内客数 $L$，平均到着率 $\lambda$，平均滞在時間 $W$ の関係を示すものである．リトルの法則は次式で表される．

$$
L = \lambda W
$$

すなわち，平均系内客数 $L$ は，平均到着率 $\lambda$ と平均滞在時間 $W$ の積に等しい．

:::{#exm-university}
### 大学の在籍学生数

ある大学の経営システム系では，毎年80人の新入生が入学し，卒業までに4年間在籍する．このとき，経営システム系に在籍している学生の平均人数を求めよ．

平均到着率 $\lambda$ は80人/年，平均滞在時間 $W$ は4年である．リトルの法則により，平均系内客数 $L$ は次のように求められる．

$$
L = \lambda W = 80 \times 4 = 320 \text{ 人}
$$

よって，経営システム系には320人の学生が在籍していることになる．
:::

平均待ち行列長 $L_q$，平均待ち時間 $W_q$ と平均到着率 $\lambda$ の関係も同様にリトルの法則で表される．すなわち，

$$
L_q = \lambda W_q
$$

である．

さらに，平均滞在時間 $W$ は，平均待ち時間 $W_q$ と平均サービス時間 $1/\mu$ の和であるから，次の式で表される．

$$
W = W_q + \frac{1}{\mu}
$$

:::{#exm-bank}
ある銀行では，1時間に平均20人の客が来店し，各客が銀行に滞在する平均時間は12分である．このとき，この銀行には平均何人の客がいるか．

平均到着率 $\lambda$ は20人/時間，平均滞在時間 $W = 12 \text{ 分} = 12/60 \text{ 時間}$ である．リトルの法則から，平均系内客数 $L$ は

$$
L = \lambda W = 20 \times \frac{12}{60} = 4 \text{ 人}
$$

となる．すなわち，銀行内には平均して4人の客が滞在する．平均滞在時間 $W$ や平均到着率 $\lambda$ が増加すると，平均系内客数 $L$ も増加することがわかる．

さらに，平均サービス時間は6分であるとすると，平均待ち時間 $W_q$ と平均待ち行列長 $L_q$ はそれぞれ

$$
W_q = W - \frac{1}{\mu} = 12 - 6 = 6 \text{ 分}
$$

$$
L_q = \lambda W_q = 20 \times \frac{6}{60} = 2 \text{ 人}
$$

となる．つまり，客が行列で待つ平均時間は6分，1時間あたり平均2人の客が行列で待っていることになる．
:::

## 用語集

| 英語                    | 日本語       |
| ----------------------- | ------------ |
| service facility       | サービス施設 |
| server                 | サーバ     |
| number of servers      | サーバ数   |
| interarrival time      | 到着間隔   |
| service time           | サービス時間 |
