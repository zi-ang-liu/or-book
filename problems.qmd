---
title: 演習問題
format:
  html:
    code-fold: true
jupyter: python3
---

## EOQ

:::{#exr-eoq-candy}
あるキャンディ専門店では，毎月1300本のペロペロキャンディが販売されている．発注にかかる費用は1回あたり8ドル，ペロペロキャンディの仕入れ単価は1本あたり0.75ドル，保管費用は1本あたり月0.225ドルである．ペロペロキャンディの発注量は整数でなければならない．EOQモデルを用いて，最適発注量と最適サイクル期間を求めよ．
:::

:::{#sol-eoq-candy}
需要率は $d = 1300$ で，発注費用は $K = 8$，保管費用は $h = 0.225$，購入単価は $c = 0.75$ である．
経済的発注量 $Q^*$ は
$$
Q^* = \sqrt{\frac{2Kd}{h}} = \sqrt{\frac{2 \cdot 8 \cdot 1300}{0.225}} \approx 304.05 \text{ 個}
$$
となる．ペロペロキャンディの発注量が整数である必要があるため，$g(304)$ と $g(305)$ を比較して最適発注量を決定する．
$$
g(304) = \frac{8 \cdot 1300}{304} + 0.225 \cdot 304 / 2 \approx 68.4105
$$
$$
g(305) = \frac{8 \cdot 1300}{305} + 0.225 \cdot 305 / 2 \approx 68.4109
$$
$g(304) < g(305)$ であるため，最適発注量は $Q^* = 304$ 本となる．
サイクル期間 $T^*$ は
$$
T^* = \frac{Q^*}{d} = \frac{304}{1300} \approx 0.23 \text{ 月}
$$
となる．
```{python}
import numpy as np

K = 8  # Order cost
d = 1300  # Demand rate (units per month)
h = 0.225  # Holding cost (per unit per month)
c = 0.75  # Purchase cost (per unit)
Q_star = np.sqrt(2 * K * d / h)
print(f"EOQ (Q*): {Q_star:.4f} units")


# Since order quantity must be an integer, compare g(304) and g(305)
def g(Q):
    return (K * d / Q) + (h * Q / 2)


g_304 = g(304)
g_305 = g(305)
optimal_Q = 304 if g_304 < g_305 else 305
T_star = optimal_Q / d
print(f"Optimal Order Quantity (Q*): {optimal_Q} units")
print(f"Optimal Cycle Time (T*): {T_star:.3f} months")
```
:::

## 新聞売子問題

:::{#exr-newsvendor-boy}
新聞売り子が新聞を仕入れ，販売する問題を考える。新聞 1 部の在庫不足費用を $p = 0.7$，在庫超過費用を $h = 0.18$ とする。新聞の需要 $D$ は，正規分布 $N(50, 8^2)$ に従うとする。このとき，最適な発注量を求めよ。

なお，標準正規分布 $Z \sim N(0,1)$ の累積分布関数を $\Phi(z)$ とし，$\Phi(0.82) \approx 0.795$ を用いてよい．
:::

:::{#sol-newsvendor-boy}
在庫超過費用 $h$，在庫不足費用 $p$ は以下のように与えられる。
$$
h = 0.18, \quad p = 0.7
$$

したがって，$S^*$ は以下のように求められる。
$$
S^* = F_D^{-1}\left(\frac{p}{h + p}\right) = F_D^{-1}\left(\frac{0.7}{0.18 + 0.7}\right) \approx F_D^{-1}\left(0.795\right)
$$

標準正規分布表を調べると，$\Phi(z) = 0.795$ のとき，$z$ は約 0.82 である。したがって，$S^*$ は
$$
S^* = 0.82 \times \sigma + \mu = 0.82 \times 8 + 50 \approx 56.56
$$
となる。
:::

## AHP

:::{#exr-ahp-car}
田中さんは，新しく自動車の購入を検討している。候補としてA車，B車，C車の三つがある。田中さんは，デザイン，安全性，価格の3つの評価基準で自動車を評価したいと考え，以下の一対比較表を作成した。AHPを用いて，以下の問いに答えよ。ただし，整合性のもたない一対比較行列については，幾何平均法を用いて重要度ベクトルを算出すること．

1. 評価基準の一対比較表から，重要度ベクトルを求めよ。
2. デザイン，安全性，価格の一対比較表から，それぞれの重要度ベクトルを求めよ。
3. A車，B車，C車の総合評価を求め，最も評価の高い自動車を答えよ。

| 評価基準 | デザイン | 安全性 | 価格 |
|----------|----------|--------|------|
| デザイン | 1        | 3      | 5    |
| 安全性   | 1/3      | 1      | 2    |
| 価格     | 1/5      | 1/2    | 1    |

| デザイン | A | B | C |
|----------|---|---|---|
| A        | 1 | 1 | 4 |
| B        | 1 | 1 | 4 |
| C        | 1/4 | 1/4 | 1 |

| 安全性 | A | B | C |
|--------|---|---|---|
| A      | 1 | 2 | 6 |
| B      | 1/2 | 1 | 3 |
| C      | 1/6 | 1/3 | 1 |

| 価格 | A | B | C |
|------|---|---|---|
| A    | 1 | 1/2 | 1/8 |
| B    | 2 | 1   | 1/4 |
| C    | 8 | 4   | 1   |
:::

:::{#sol-ahp-car}

1. 評価基準の一対比較行列は以下の通りである。

$$
\mathbf{B} = \begin{bmatrix}
1 & 3 & 5 \\
1/3 & 1 & 2 \\
1/5 & 1/2 & 1
\end{bmatrix}
$$

$\mathbf{B}$ の重要度ベクトルは，幾何平均法を用いて以下のように求められる。
$$
\mathbf{w}= \begin{bmatrix}
0.65 \\
0.23 \\
0.12
\end{bmatrix}
$$

2. デザイン，安全性，価格の一対比較表から，それぞれの重要度ベクトルを求めよ。
$$
\mathbf{A}_{\text{1}} = \begin{bmatrix}
1 & 1 & 4 \\
1 & 1 & 4 \\
1/4 & 1/4 & 1
\end{bmatrix}, \quad
\mathbf{A}_{\text{2}} = \begin{bmatrix}
1 & 2 & 6 \\
1/2 & 1 & 3 \\
1/6 & 1/3 & 1
\end{bmatrix}, \quad
\mathbf{A}_{\text{3}} = \begin{bmatrix}
1 & 1/2 & 1/8 \\
2 & 1 & 1/4 \\
8 & 4 & 1
\end{bmatrix}
$$

それぞれの重要度ベクトルは，以下のように求められる。

$$
\mathbf{w}_{\text{1}} = \begin{bmatrix}
4/9 \\
4/9 \\
1/9
\end{bmatrix}, \quad
\mathbf{w}_{\text{2}} = \begin{bmatrix}
6/10 \\
3/10 \\
1/10
\end{bmatrix}, \quad
\mathbf{w}_{\text{3}} = \begin{bmatrix}
1/11 \\
2/11 \\
8/11
\end{bmatrix}
$$

3. 田中さんの総合評価ベクトル $\mathbf{v}$ は，以下のように求められる。
$$
\mathbf{v} = 0.65 \cdot \mathbf{w}_{\text{1}} + 0.23 \cdot \mathbf{w}_{\text{2}} + 0.12 \cdot \mathbf{w}_{\text{3}} = \mathbf{v} = \begin{bmatrix}
0.44\\
0.38\\
0.18
\end{bmatrix}
$$

これより，田中さんはA車を購入するのが最も良いと判断できる。

```{python}
import numpy as np
w = np.array([0.65, 0.23, 0.12])
w1 = np.array([4/9, 4/9, 1/9])
w2 = np.array([6/10, 3/10, 1/10])
w3 = np.array([1/11, 2/11, 8/11])
v = w[0] * w1 + w[1] * w2 + w[2] * w3
print("Overall evaluation vector v:", v)
```

:::
## CCR モデル

:::{#exr-ccr-production}
ある会社は，以下の4つの店舗を運営している。データは以下の通りである。

| 店舗 | A | B | C | D |
|------|---|---|---|---|
| 従業員数 | 40 | 60 |  60 | 80 |
| 売上高| 20 | 60 | 40 | 60 |

CCRモデルを用いて，以下の問いに答えよ。ただし，効率性を $\theta$，従業員数に対する重みを $v$，売上高に対する重みを $u$ とする。

1. 店舗 A の効率性を判定するCCRモデルを線形計画問題として定式化せよ。
2. 上記の線形計画問題を解き，最適値 $\theta^*$，最適解 $(v^*, u^*)$ を求め，店舗 A は効率的か非効率的かを判定せよ．
3. 店舗 A は非効率的の場合，参照集合を示し，改善案を提案せよ．
:::

:::{#sol-ccr-production}
1. 店舗 A の効率性を判定するCCRモデルは，以下のように定式化される。

$$
\begin{align*}
\text{minimize} \quad & 20 u \\
\text{subject to} \quad & 40 v = 1 \\
& 20 u - 40 v \leq 0 \\
& 60 u - 60 v \leq 0 \\
& 40 u - 60 v \leq 0 \\
& 60 u - 80 v \leq 0 \\
& u, v \geq 0
\end{align*}
$$

2. 上記の線形計画問題を解く．最適値 $\theta^* = 0.5$, 最適解 $u^* = 0.025$, $v^* = 0.025$ である．店舗 A は非効率的である．なぜなら，$\theta^* = 0.5 < 1$ であるからである． 

3. 参照集合は $\mathcal{R}_A = \{B\}$ である．改善案として，店舗 A の売上高を 40 に増加させるか，従業員数を 20 に減少させることが考えられる．
:::

## 動的計画法

:::{#exr-dp-longest-path}
有向グラフ $G = (V, E)$ を考える．各辺 $(u, v) \in E$ には重み $w(u, v)$ が与えられている．始点を $s$，終点を $t$ とする．点 $v$ から出る辺の終点の集合を

$$
\mathcal{S}(v) = \{u \in V \mid (v, u) \in E\}
$$ 
とする．例えば，$\mathcal{S}(s) = \{a, b, c\}$ である．

点 $v$ から点 $t$ までの最短路の長さを $d(v)$ とすると，最適性の原理より，

$$
d(v) = \min_{u \in \mathcal{S}(v)} \{w(v, u) + d(u)\}
$$ 
が成り立つ．

ここからは，これと同様の考え方を $G$ における最長路問題に適用する．以下では，点 $v$ から点 $t$ までの最長路の長さを $d(v)$ とする．

1. 最適性の原理に基づき，$d(v)$ を表す再帰方程式を示せ．
2. 以上の再帰方程式を用いて，点 $s$ から点 $t$ までの最長路の長さ $d(s)$ を求めよ．ただし，計算過程を示すこと．
3. 点 $s$ から点 $t$ までの最長路のパス $P$ を求めよ．


```{python}
import networkx as nx
import matplotlib.pyplot as plt

G = nx.DiGraph()
edges = [
    ("s", "a", 5),
    ("s", "b", 6),
    ("s", "c", 4),
    ("a", "d", 2),
    ("a", "e", 5),
    ("b", "d", 1),
    ("b", "e", 3),
    ("c", "e", 4),
    ("c", "f", 1),
    ("d", "t", 2),
    ("e", "t", 1),
    ("f", "t", 2),
]
G.add_weighted_edges_from(edges)

for layer, nodes in enumerate(nx.topological_generations(G)):
    for node in nodes:
        G.nodes[node]["layer"] = layer

pos = {
    "s": (0, 0),
    "a": (1, 1),
    "b": (1, 0),
    "c": (1, -1),
    "d": (2, 1),
    "e": (2, 0),
    "f": (2, -1),
    "t": (3, 0),
}

nx.draw(G, pos, with_labels=True, node_size=700, node_color="lightblue", font_size=10)
edge_labels = nx.get_edge_attributes(G, "weight")
nx.draw_networkx_edge_labels(
    G, pos, edge_labels=edge_labels, label_pos=0.3, font_size=8, rotate=False
)
plt.show()
```

:::

:::{#sol-dp-longest-path}
1. 最適性の原理に基づき，$d(v)$ を表す再帰方程式は以下のようになる。

$$
d(v) = \max_{u \in \mathcal{S}(v)} \{w(v, u) + d(u)\}
$$

2. 再帰方程式を用いて，点 $s$ から点 $t$ までの最長路の長さ $d(s)$ を求める．計算過程は以下の通りである。

- $d(t) = 0$
- $d(d) = \max\{w(d, t) + d(t)\} = \max\{2 + 0\} = 2$
- $d(e) = \max\{w(e, t) + d(t)\} = \max\{1 + 0\} = 1$
- $d(f) = \max\{w(f, t) + d(t)\} = \max\{2 + 0\} = 2$
- $d(a) = \max\{w(a, d) + d(d), w(a, e) + d(e)\} = \max\{2 + 2, 5 + 1\} = 6$
- $d(b) = \max\{w(b, d) + d(d), w(b, e) + d(e)\} = \max\{1 + 2, 3 + 1\} = 4$
- $d(c) = \max\{w(c, e) + d(e), w(c, f) + d(f)\} = \max\{4 + 1, 1 + 2\} = 5$
- $d(s) = \max\{w(s, a) + d(a), w(s, b) + d(b), w(s, c) + d(c)\} = \max\{5 + 6, 6 + 4, 4 + 5\} = 11$

したがって，点 $s$ から点 $t$ までの最長路の長さは $d(s) = 11$ である．

3. 点 $s$ から点 $t$ までの最長路のパス $P$ を求める．

$P = (s, a, e, t)$ である．
:::